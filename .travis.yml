language: node_js
node_js:
- '8'
before_install:
- npm i -g makeshift && makeshift -r https://registry.npmjs.org
- npm i -g standard-version
before_script:
- cd /tmp
- wget https://github.com/github/hub/releases/download/v2.5.1/hub-linux-386-2.5.1.tgz
- tar -xvzf hub-linux-386-2.5.1.tgz
- mv hub-linux-386-2.5.1 hub
- export GOPATH="/tmp/go"
- export PATH=${PATH}:/tmp/hub/bin:${GOPATH}/bin
- git clone https://github.com/ibm-developer/standard-npm-devops.git
- npm --prefix ./standard-npm-devops install fs-extra bluebird
- cd -
script:
  - NODE_ENV=production node /tmp/standard-npm-devops/install_linked_dependencies.js || travis_terminate 1
  - npm run lint || travis_terminate 1
  - npm test || travis_terminate 1
  - npm run coveralls || travis_terminate 1
  - /tmp/standard-npm-devops/do_devops.sh
  - if [ -z $TRAVIS_PULL_REQUEST_BRANCH ]; then $DEVOPS_SCRIPT_DIR/do_devops_insights_reporting.sh; fi
branches:
  only:
  - master
  - develop
env:
  - DEV_BRANCH=develop 
  - PROD_BRANCH=master 
  - DEVOPS_SCRIPT_DIR="/tmp/standard-npm-devops" 
  - UPDATE_DEPENDENCIES="./linked_dependencies.json"
  # below are idra's necessary environment variables to report to devops-insights
  # IBM_CLOUD_API_KEY and TOOLCHAIN_ID need to be defined from travis GUI
  - ORGANIZATION_NAME=devops-insights
  - LOGICAL_APP_NAME=generator-ibm-usecase-enablement
  - GIT_URL=https://github.com/ibm-developer/generator-ibm-usecase-enablement
  - DEVOPS_REPORT_DIR=/tmp/devops_insights/

